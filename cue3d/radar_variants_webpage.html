<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Cue Performance Visualization</title>
  <!-- Import ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: white;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      padding: 20px;
    }
    
    .chart-title {
      text-align: center;
      margin-bottom: 15px;
      color: #333;
      font-size: 1.2rem;
    }
    
    .controls-container {
      margin-bottom: 30px;
    }
    
    .model-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .model-group {
      position: relative;
    }
    
    .model-btn {
      width: 150px;
      padding: 8px 12px;
      background-color: white;
      border: 2px solid #ddd;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    
    .model-btn[data-active="true"].model-3d:hover {
      border-color: #871510;
    }
    
    .model-btn[data-active="true"].model-2d:hover {
      border-color: #E19645;
    }
    
    .model-label {
      font-weight: bold;
      font-size: 0.85rem;
      transition: color 0.3s;
    }
    
    .model-btn[data-active="true"].model-3d .model-label {
      color: #871510;
    }
    
    .model-btn[data-active="false"] .model-label {
      color: #999;
    }
    
    .model-btn[data-active="true"].model-2d .model-label {
      color: #E19645;
    }
    
    .dropdown-btn {
      padding: 4px;
      background: transparent;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      color: #666;
      transition: all 0.2s;
    }
    
    .dropdown-btn svg {
      width: 14px;
      height: 14px;
    }
    
    .model-btn[data-active="true"].model-3d .dropdown-btn:hover {
      background-color: rgba(135, 21, 16, 0.1);
      color: #871510;
    }
    
    .model-btn[data-active="true"].model-2d .dropdown-btn:hover {
      background-color: rgba(225, 150, 69, 0.1);
      color: #E19645;
    }
    
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      margin-top: 5px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 10;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s;
    }
    
    .dropdown-menu.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .dropdown-item {
      padding: 6px 12px;
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 0.85rem;
    }
    
    .dropdown-item:hover {
      background-color: #f5f5f5;
    }
    
    .dropdown-item input {
      margin-right: 8px;
      width: 14px;
      height: 14px;
    }
    
    .dataset-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
    }
    
    .dataset-btn {
      padding: 6px 12px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 0.85rem;
      cursor: pointer;
      border: 2px solid;
      transition: all 0.3s;
      background-color: transparent;
      opacity: 0.5;
    }
    
    #gso-btn {
      border-color: #9A6500;
      color: black;
    }
    
    #toys4k-btn {
      border-color: #564668;
      color: black;
    }
    
    #zeroverse-btn {
      border-color: #444B0B;
      color: black;
    }
    
    .dataset-btn[data-active="true"] {
      opacity: 1;
      color: white;
    }
    
    #gso-btn[data-active="true"] {
      background-color: #9A6500;
    }
    
    #toys4k-btn[data-active="true"] {
      background-color: #564668;
    }
    
    #zeroverse-btn[data-active="true"] {
      background-color: #444B0B;
    }
    
    #radarChart {
      height: 600px;
      width: 100%;
    }
    
    .chart-container {
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .model-btn {
        width: 130px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="chart-title">Performance Robustness to the Perturbation of Each Cue</h2>
    
    <div class="controls-container">
      <div class="model-controls">
        <!-- Regression Models -->
        <div class="model-group">
          <div class="model-btn model-3d" data-active="true" id="regression-btn-container">
            <div id="regression-btn" class="model-label" data-active="true">Regression Models</div>
            <button id="regression-dropdown-btn" class="dropdown-btn" aria-expanded="false">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          <div class="dropdown-menu" id="regression-dropdown">
            <div class="dropdown-item">
              <input type="checkbox" name="regression-sf3d" value="sf3d" checked>
              <span>SF3D</span>
            </div>
            <div class="dropdown-item">
              <input type="checkbox" name="regression-openlrm" value="openlrm" checked>
              <span>OpenLRM</span>
            </div>
          </div>
        </div>
        
        <!-- Multiview Models -->
        <div class="model-group">
          <div class="model-btn model-2d" data-active="true" id="multiview-btn-container">
            <div id="multiview-btn" class="model-label" data-active="true">Multiview Models</div>
            <button id="multiview-dropdown-btn" class="dropdown-btn" aria-expanded="false">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          <div class="dropdown-menu" id="multiview-dropdown">
            <div class="dropdown-item">
              <input type="checkbox" name="multiview-instantmesh" value="instantmesh" checked>
              <span>InstantMesh</span>
            </div>
            <div class="dropdown-item">
              <input type="checkbox" name="multiview-crm" value="crm" checked>
              <span>CRM</span>
            </div>
            <div class="dropdown-item">
              <input type="checkbox" name="multiview-lgm" value="lgm" checked>
              <span>LGM</span>
            </div>
          </div>
        </div>
        
        <!-- Native Models -->
        <div class="model-group">
          <div class="model-btn model-2d" data-active="true" id="native-btn-container">
            <div id="native-btn" class="model-label" data-active="true">Native Models</div>
            <button id="native-dropdown-btn" class="dropdown-btn" aria-expanded="false">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          <div class="dropdown-menu" id="native-dropdown">
            <div class="dropdown-item">
              <input type="checkbox" name="native-trellis" value="trellis" checked>
              <span>Trellis</span>
            </div>
            <div class="dropdown-item">
              <input type="checkbox" name="native-hunyuan3d" value="hunyuan3d" checked>
              <span>Hunyuan3D-2</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="dataset-controls">
        <button id="gso-btn" class="dataset-btn" data-active="true">
          GSO
        </button>
        <button id="toys4k-btn" class="dataset-btn" data-active="false">
          Toys4K
        </button>
        <!-- <button id="zeroverse-btn" class="dataset-btn" data-active="false">
          Zeroverse
        </button> -->
      </div>
    </div>
    
    <div class="chart-container">
      <div id="radarChart"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ===== DATA DEFINITIONS =====
      // Indicators will be set dynamically based on the loaded dataset
      let indicators = [];

      // Replace the empty actualData object with the actual data


      const actualData = {
  "gso": {
    "LGM": [
      {
        "cue_type": "Texture",
        "value": 0.8462
      },
      {
        "cue_type": "Shading",
        "value": 0.7342
      },
      {
        "cue_type": "Silhouette",
        "value": 0.5696
      },
      {
        "cue_type": "Occlusion",
        "value": 0.5842
      },
      {
        "cue_type": "Edges",
        "value": 0.9296
      },
      {
        "cue_type": "Perspective",
        "value": 0.8993
      },
      {
        "cue_type": "Local",
        "value": 0.8375
      },
      {
        "cue_type": "Style",
        "value": 0.8984
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.9373
      }
    ],
    "OpenLRM": [
      {
        "cue_type": "Texture",
        "value": 0.9363
      },
      {
        "cue_type": "Shading",
        "value": 0.829
      },
      {
        "cue_type": "Silhouette",
        "value": 0.3056
      },
      {
        "cue_type": "Occlusion",
        "value": 0.7356
      },
      {
        "cue_type": "Edges",
        "value": 0.9813
      },
      {
        "cue_type": "Perspective",
        "value": 0.8657
      },
      {
        "cue_type": "Local",
        "value": 0.9304
      },
      {
        "cue_type": "Style",
        "value": 0.9557
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.6905
      }
    ],
    "CRM": [
      {
        "cue_type": "Texture",
        "value": 0.8993
      },
      {
        "cue_type": "Shading",
        "value": 0.6977
      },
      {
        "cue_type": "Silhouette",
        "value": 0.7129
      },
      {
        "cue_type": "Occlusion",
        "value": 0.5674
      },
      {
        "cue_type": "Edges",
        "value": 0.9724
      },
      {
        "cue_type": "Perspective",
        "value": 1.0359
      },
      {
        "cue_type": "Local",
        "value": 0.7543
      },
      {
        "cue_type": "Style",
        "value": 0.8925
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.7362
      }
    ],
    "SF3D": [
      {
        "cue_type": "Texture",
        "value": 0.9964
      },
      {
        "cue_type": "Shading",
        "value": 0.5764
      },
      {
        "cue_type": "Silhouette",
        "value": 0.3963
      },
      {
        "cue_type": "Occlusion",
        "value": 0.4998
      },
      {
        "cue_type": "Edges",
        "value": 0.9399
      },
      {
        "cue_type": "Perspective",
        "value": 0.8373
      },
      {
        "cue_type": "Local",
        "value": 0.2603
      },
      {
        "cue_type": "Style",
        "value": 0.6378
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.433
      }
    ],
    "InstantMesh": [
      {
        "cue_type": "Texture",
        "value": 0.9446
      },
      {
        "cue_type": "Shading",
        "value": 0.818
      },
      {
        "cue_type": "Silhouette",
        "value": 0.5314
      },
      {
        "cue_type": "Occlusion",
        "value": 0.3575
      },
      {
        "cue_type": "Edges",
        "value": 0.9606
      },
      {
        "cue_type": "Perspective",
        "value": 0.9062
      },
      {
        "cue_type": "Local",
        "value": 0.751
      },
      {
        "cue_type": "Style",
        "value": 0.7712
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.3113
      }
    ],
    "Hunyuan3D-2": [
      {
        "cue_type": "Texture",
        "value": 0.9827
      },
      {
        "cue_type": "Shading",
        "value": 0.7726
      },
      {
        "cue_type": "Silhouette",
        "value": 0.8403
      },
      {
        "cue_type": "Occlusion",
        "value": 0.6838
      },
      {
        "cue_type": "Edges",
        "value": 0.9815
      },
      {
        "cue_type": "Perspective",
        "value": 0.8734
      },
      {
        "cue_type": "Local",
        "value": 0.8084
      },
      {
        "cue_type": "Style",
        "value": 0.7286
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.2849
      }
    ],
    "Trellis": [
      {
        "cue_type": "Texture",
        "value": 0.9792
      },
      {
        "cue_type": "Shading",
        "value": 0.7033
      },
      {
        "cue_type": "Silhouette",
        "value": 0.944
      },
      {
        "cue_type": "Occlusion",
        "value": 0.5369
      },
      {
        "cue_type": "Edges",
        "value": 0.9363
      },
      {
        "cue_type": "Perspective",
        "value": 0.9286
      },
      {
        "cue_type": "Local",
        "value": 0.5763
      },
      {
        "cue_type": "Style",
        "value": 0.7513
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.241
      }
    ]
  },
  "toys4k_small": {
    "LGM": [
      {
        "cue_type": "Texture",
        "value": 0.9589
      },
      {
        "cue_type": "Shading",
        "value": 0.7669
      },
      {
        "cue_type": "Silhouette",
        "value": 0.3216
      },
      {
        "cue_type": "Occlusion",
        "value": 0.5341
      },
      {
        "cue_type": "Edges",
        "value": 0.9217
      },
      {
        "cue_type": "Perspective",
        "value": 0.9625
      },
      {
        "cue_type": "Local",
        "value": 0.8452
      },
      {
        "cue_type": "Style",
        "value": 0.9548
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.819
      }
    ],
    "OpenLRM": [
      {
        "cue_type": "Texture",
        "value": 0.9785
      },
      {
        "cue_type": "Shading",
        "value": 0.8557
      },
      {
        "cue_type": "Silhouette",
        "value": 0.03
      },
      {
        "cue_type": "Occlusion",
        "value": 0.6879
      },
      {
        "cue_type": "Edges",
        "value": 1.0091
      },
      {
        "cue_type": "Perspective",
        "value": 0.906
      },
      {
        "cue_type": "Local",
        "value": 1.0041
      },
      {
        "cue_type": "Style",
        "value": 0.9723
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.5702
      }
    ],
    "CRM": [
      {
        "cue_type": "Texture",
        "value": 0.9799
      },
      {
        "cue_type": "Shading",
        "value": 0.6569
      },
      {
        "cue_type": "Silhouette",
        "value": 0.4582
      },
      {
        "cue_type": "Occlusion",
        "value": 0.5952
      },
      {
        "cue_type": "Edges",
        "value": 0.9706
      },
      {
        "cue_type": "Perspective",
        "value": 1.031
      },
      {
        "cue_type": "Local",
        "value": 0.8352
      },
      {
        "cue_type": "Style",
        "value": 0.88
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.6142
      }
    ],
    "SF3D": [
      {
        "cue_type": "Texture",
        "value": 0.9907
      },
      {
        "cue_type": "Shading",
        "value": 0.4333
      },
      {
        "cue_type": "Silhouette",
        "value": 0.2488
      },
      {
        "cue_type": "Occlusion",
        "value": 0.3811
      },
      {
        "cue_type": "Edges",
        "value": 0.9148
      },
      {
        "cue_type": "Perspective",
        "value": 0.8413
      },
      {
        "cue_type": "Local",
        "value": 0.3449
      },
      {
        "cue_type": "Style",
        "value": 0.5675
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.2595
      }
    ],
    "InstantMesh": [
      {
        "cue_type": "Texture",
        "value": 1.0018
      },
      {
        "cue_type": "Shading",
        "value": 0.7965
      },
      {
        "cue_type": "Silhouette",
        "value": 0.4945
      },
      {
        "cue_type": "Occlusion",
        "value": 0.389
      },
      {
        "cue_type": "Edges",
        "value": 1.0028
      },
      {
        "cue_type": "Perspective",
        "value": 0.9562
      },
      {
        "cue_type": "Local",
        "value": 0.779
      },
      {
        "cue_type": "Style",
        "value": 0.6709
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.2187
      }
    ],
    "Hunyuan3D-2": [
      {
        "cue_type": "Texture",
        "value": 0.9969
      },
      {
        "cue_type": "Shading",
        "value": 0.7697
      },
      {
        "cue_type": "Silhouette",
        "value": 0.7703
      },
      {
        "cue_type": "Occlusion",
        "value": 0.7202
      },
      {
        "cue_type": "Edges",
        "value": 0.9976
      },
      {
        "cue_type": "Perspective",
        "value": 0.8898
      },
      {
        "cue_type": "Local",
        "value": 0.8768
      },
      {
        "cue_type": "Style",
        "value": 0.6947
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.2224
      }
    ],
    "Trellis": [
      {
        "cue_type": "Texture",
        "value": 0.9924
      },
      {
        "cue_type": "Shading",
        "value": 0.7355
      },
      {
        "cue_type": "Silhouette",
        "value": 0.9586
      },
      {
        "cue_type": "Occlusion",
        "value": 0.5716
      },
      {
        "cue_type": "Edges",
        "value": 0.9787
      },
      {
        "cue_type": "Perspective",
        "value": 0.9594
      },
      {
        "cue_type": "Local",
        "value": 0.7258
      },
      {
        "cue_type": "Style",
        "value": 0.7809
      },
      {
        "cue_type": "Shape Meaningfulness",
        "value": 0.2043
      }
    ]
  }
};




      // Colors for each model
      const colors = {
        SF3D: '#B2CBC2',
        OpenLRM: '#BBC990',
        InstantMesh: '#B45342',
        CRM: '#DCAC99',
        LGM: '#6F936B',
        Trellis: '#EBA062',
        "Hunyuan3D-2": '#9A8EB4'
      };

      const modelGroups = {
        'regression': {
          'sf3d': ['SF3D'],
          'openlrm': ['OpenLRM']
        },
        'multiview': {
          'instantmesh': ['InstantMesh'],
          'crm': ['CRM'],
          'lgm': ['LGM']
        },
        'native': {
          'trellis': ['Trellis'],
          'hunyuan3d': ['Hunyuan3D-2']
        }
      };

      // Keep track of the current dataset
      let currentDataset = 'gso';

      // Cue type colors
      const cueTypeColors = {
        // 'Baseline': '#9A6500',
        'Shading': '#564668',
        'Texture': '#444B0B',
        'Silhouette': '#B45342',
        'Occlusion': '#6F936B',
        'Edges': '#EBA062',
        'Local': '#5B7DB1',
        'Perspective': '#9A8EB4',
        'Style': '#878787',
        'Shape Meaningfulness': '#C15D7A'
        // 'Local_continuity': '#5B7DB1'
      };

      // Initialize the indicators based on cue types
      const initializeIndicators = () => {
        indicators = [];
        
        // Get all unique cue types from the first model in the current dataset
        const firstModel = Object.keys(actualData[currentDataset])[0];
        const cueData = actualData[currentDataset][firstModel];
        
        cueData.forEach(item => {
          indicators.push({
            name: item.cue_type,
            max: 1
          });
        });
        
        return indicators;
      };

      // Initialize indicators
      indicators = initializeIndicators();

      // ===== CHART INITIALIZATION =====
      const chartDom = document.getElementById('radarChart');
      const myChart = echarts.init(chartDom, null, {
        devicePixelRatio: window.devicePixelRatio || 2,
        renderer: 'canvas'
      });
      

      // Create rich text style with correct colors
      const richStyles = {};
      for (const [cueType, color] of Object.entries(cueTypeColors)) {
        // Create a safe key without spaces for the rich text formatter
        const safeKey = cueType.replace(/\s+/g, '_');
        richStyles[safeKey] = {
          fontWeight: 'bold',
          fontSize: 14,
          fontFamily: 'Arial, sans-serif',
          color: color,
          align: 'center',
          // lineHeight: 30
        };
      }

      const option = {
        grid: {
          right: '5%',
          left: '5%',
          top: '5%',
          bottom: '25%'
        },
        legend: {
          show: true,
          orient: 'horizontal',
          bottom: 5,
          left: 'center',
          padding: [10, 10, 10, 10],
          borderWidth: 0,
          backgroundColor: 'transparent', 
          data: [], // Will be populated from current dataset
          textStyle: {
            fontSize: 11,
            fontFamily: 'Arial, sans-serif'
          },
          icon: 'circle',
          itemWidth: 10,
          itemHeight: 10,
          itemGap: 10,
          selected: {
            'SF3D': true,
            'OpenLRM': false,
            'InstantMesh': true,
            'CRM': false,
            'LGM': false,
            'Trellis': true,
            'Hunyuan3D-2': true
          }
        },
        toolbox: {
          show: true,
          right: 10,
          top: 10,
          feature: {
            myTool: {
              show: true,
              title: 'Select/Deselect All',
              icon: 'path://M432.45,595.444c0,2.177-4.661,6.82-11.305,6.82c-6.475,0-11.306-4.567-11.306-6.82s4.852-6.812,11.306-6.812C427.841,588.632,432.452,593.191,432.45,595.444L432.45,595.444z M421.155,589.876c-3.009,0-5.448,2.495-5.448,5.572s2.439,5.572,5.448,5.572c3.01,0,5.449-2.495,5.449-5.572C426.604,592.371,424.165,589.876,421.155,589.876L421.155,589.876z M421.146,591.891c-1.916,0-3.47,1.589-3.47,3.549c0,1.959,1.554,3.548,3.47,3.548s3.469-1.589,3.469-3.548C424.614,593.479,423.062,591.891,421.146,591.891L421.146,591.891zM421.146,591.891',
              onclick: function() {
                const currentData = getCurrentDataset();
                const allSelected = !Object.values(myChart.getOption().legend[0].selected).every(v => v);
                const newSelected = {};
                Object.keys(currentData).forEach(key => {
                  newSelected[key] = allSelected;
                });
                
                myChart.setOption({
                  legend: { selected: newSelected }
                });

                ['regression', 'multiview', 'native'].forEach(prefix => {
                  document.querySelectorAll(`input[name^="${prefix}-"]`).forEach((checkbox) => {
                    checkbox.checked = allSelected;
                  });

                  const btn = document.getElementById(`${prefix}-btn`);
                  if (btn) {
                    btn.setAttribute('data-active', allSelected.toString());
                    document.getElementById(`${prefix}-btn-container`).setAttribute('data-active', allSelected.toString());
                  }
                });
              }
            },
            saveAsImage: {
              title: 'Save as Image',
              pixelRatio: 3
            }
          },
          itemSize: 12,
          itemGap: 8,
          orient: 'horizontal',
        },
        tooltip: {
          trigger: 'item',
          backgroundColor: 'rgba(255, 255, 255, 0.9)',
          borderColor: '#ccc',
          borderWidth: 1,
          textStyle: {
            color: '#333',
            fontFamily: 'Arial, sans-serif'
          },
          formatter: function(params) {
            const modelName = params.name;
            const currentData = getCurrentDataset();
            const modelData = currentData[modelName];
            
            let result = `<span style="color: ${colors[modelName]}; font-size: 16px; text-shadow: 1px 1px 2px #000;"><b>${modelName}</b></span><br/>`;
            
            for (const cueItem of modelData) {
              const cueType = cueItem.cue_type;
              const value = cueItem.value;
              // const rawDiff = cueItem.raw_difference;
              const color = cueTypeColors[cueType] || '#333';
              
              result += `<span style="color: ${color}"><b>${cueType}:</b></span> ${value.toFixed(4)}<br/>`;
            }
            
            return result;
          }
        },
        radar: {
          indicator: indicators,
          shape: 'polygon',
          startAngle: 110,
          splitNumber: 4,
          nameGap: 45,
          center: ['50%', '45%'],
          radius: '62%',
          axisName: {
            fontSize: 11,
            fontFamily: 'Arial, sans-serif',
            align: 'center',
            rich: {
              ...richStyles,
              m: {
                fontSize: 14,
                fontFamily: 'Arial, sans-serif',
                color: '#333',
                align: 'center'
              }
            },
            formatter: function(value) {
              // Use a safe key (replace spaces with underscores) for the rich text formatter
              const safeKey = value.replace(/\s+/g, '_');
              
              // Insert a newline between Shape and Meaningfulness
              let displayValue = value;
              if (value === 'Shape Meaningfulness') {
                displayValue = 'Shape\nMeaningfulness';
              }
              
              return `{${safeKey}|${displayValue}}`;
            }
          },
          axisLine: {
            lineStyle: {
              type: 'dashed',
              width: 1.5,
              color: 'rgba(128, 128, 128, 0.4)'
            }
          },
          splitLine: {
            lineStyle: {
              type: 'dashed',
              width: 1.5,
              color: 'rgba(128, 128, 128, 0.4)'
            }
          },
          splitArea: {
            areaStyle: {
              color: '#f0f0f0',
              opacity: 0.2
            }
          }
        },
        series: [{
          type: 'radar',
          symbol: 'circle',
          symbolSize: 6,
          animation: true,
          animationDuration: 300,
          animationEasing: 'cubicOut',
          z: 2,
          data: []
        }]
      };

      // Function to get the current dataset
      const getCurrentDataset = () => {
        return actualData[currentDataset] || {};
      };

      // Function to update the chart with the current dataset
      const updateChart = () => {
        const currentData = getCurrentDataset();
        
        // Initialize indicators based on the current dataset
        indicators = initializeIndicators();
        
        // Format data for the radar chart
        const seriesData = Object.keys(currentData).map(modelName => {
          const modelData = currentData[modelName];
          return {
            name: modelName,
            value: modelData.map(item => item.value),
            lineStyle: {
              color: colors[modelName],
              width: 2
            },
            areaStyle: {
              color: colors[modelName],
              opacity: 0.05
            },
            itemStyle: {
              color: colors[modelName],
              borderWidth: 1
            },
            emphasis: {
              focus: 'series',
              scale: true,
              lineStyle: {
                width: 6,
              },
              itemStyle: {
                borderWidth: 6,
                color: colors[modelName],
              }
            }
          };
        });
        
        // Update the chart
        myChart.setOption({
          legend: {
            data: Object.keys(currentData)
          },
          radar: {
            indicator: indicators
          },
          series: [{
            data: seriesData
          }]
        });
      };

      // Apply initial configuration
      myChart.setOption(option);

      // ===== EVENT HANDLERS =====
      // Handle dataset button clicks
      document.querySelectorAll('.dataset-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const button = e.currentTarget;
          const datasetId = button.id.split('-')[0];
          
          // Update active state for all dataset buttons
          document.querySelectorAll('.dataset-btn').forEach(b => {
            b.setAttribute('data-active', 'false');
          });
          button.setAttribute('data-active', 'true');
          
          // Set current dataset
          if (datasetId === 'gso') {
            currentDataset = 'gso';
          } else if (datasetId === 'toys4k') {
            currentDataset = 'toys4k_small';
          } else if (datasetId === 'zeroverse') {
            currentDataset = 'zeroverse_small';
          }
          
          // Update chart
          updateChart();
        });
      });

      // Handle dropdown toggles
      const toggleDropdown = (prefix, show) => {
        const dropdownBtn = document.getElementById(`${prefix}-dropdown-btn`);
        const dropdown = document.getElementById(`${prefix}-dropdown`);
        const arrow = dropdownBtn?.querySelector('svg');
        
        if (dropdownBtn && dropdown && arrow) {
          dropdownBtn.setAttribute('aria-expanded', show.toString());
          arrow.style.transform = show ? 'rotate(-180deg)' : '';
          
          if (show) {
            dropdown.classList.add('visible');
          } else {
            dropdown.classList.remove('visible');
          }
        }
      };

      // Update checkboxes and chart
      const updateCheckboxesAndChart = (prefix, checked) => {
        document.querySelectorAll(`input[name^="${prefix}-"]`).forEach(checkbox => {
          checkbox.checked = checked;
        });
        updateModelSelections();
      };

      // Update chart based on selected models
      const updateModelSelections = () => {
        const selectedRegressionTypes = Array.from(document.querySelectorAll('input[name^="regression-"]:checked'))
          .map(cb => cb.value);
        
        const selectedMultiviewTypes = Array.from(document.querySelectorAll('input[name^="multiview-"]:checked'))
          .map(cb => cb.value);
          
        const selectedNativeTypes = Array.from(document.querySelectorAll('input[name^="native-"]:checked'))
          .map(cb => cb.value);

        const selectedRegressionModels = selectedRegressionTypes.flatMap(type => modelGroups['regression'][type] || []);
        const selectedMultiviewModels = selectedMultiviewTypes.flatMap(type => modelGroups['multiview'][type] || []);
        const selectedNativeModels = selectedNativeTypes.flatMap(type => modelGroups['native'][type] || []);

        const currentData = getCurrentDataset();
        const newSelected = Object.keys(currentData).reduce((acc, curr) => {
          acc[curr] = selectedRegressionModels.includes(curr) || 
                     selectedMultiviewModels.includes(curr) || 
                     selectedNativeModels.includes(curr);
          return acc;
        }, {});

        myChart.setOption({
          legend: { selected: newSelected }
        });
      };

      // Handle main button clicks
      const handleMainButtonClick = (e) => {
        const btn = e.currentTarget;
        const prefix = btn.id.split('-')[0];
        const currentState = btn.getAttribute('data-active') === 'true';
        const newState = !currentState;
        
        btn.setAttribute('data-active', newState.toString());
        document.getElementById(`${prefix}-btn-container`).setAttribute('data-active', newState.toString());
        updateCheckboxesAndChart(prefix, newState);
      };

      // Handle dropdown button clicks
      const handleDropdownButtonClick = (e) => {
        e.stopPropagation();
        const btn = e.currentTarget;
        const prefix = btn.id.split('-')[0];
        const isExpanded = btn.getAttribute('aria-expanded') === 'true';
        
        ['regression', 'multiview', 'native'].forEach(p => {
          if (p !== prefix) {
            toggleDropdown(p, false);
          }
        });

        toggleDropdown(prefix, !isExpanded);
      };

      // Handle checkbox changes
      const handleCheckboxChange = () => {
        ['regression', 'multiview', 'native'].forEach(prefix => {
          const hasChecked = Array.from(document.querySelectorAll(`input[name^="${prefix}-"]`))
            .some(cb => cb.checked);
          
          const btn = document.getElementById(`${prefix}-btn`);
          if (btn) {
            btn.setAttribute('data-active', hasChecked.toString());
            document.getElementById(`${prefix}-btn-container`).setAttribute('data-active', hasChecked.toString());
          }
        });
        
        updateModelSelections();
      };

      // Handle outside clicks to close dropdowns
      const handleOutsideClick = (e) => {
        const target = e.target;
        const isDropdownClick = 
          target.closest('#regression-dropdown-btn') || 
          target.closest('#multiview-dropdown-btn') || 
          target.closest('#native-dropdown-btn') || 
          target.closest('#regression-dropdown') || 
          target.closest('#multiview-dropdown') || 
          target.closest('#native-dropdown');
        
        if (!isDropdownClick) {
          ['regression', 'multiview', 'native'].forEach(prefix => {
            toggleDropdown(prefix, false);
          });
        }
      };

      // Attach event listeners
      ['regression-btn', 'multiview-btn', 'native-btn'].forEach(btnId => {
        const btn = document.getElementById(btnId);
        if (btn) {
          btn.addEventListener('click', handleMainButtonClick);
        }
      });

      ['regression-dropdown-btn', 'multiview-dropdown-btn', 'native-dropdown-btn'].forEach(btnId => {
        const btn = document.getElementById(btnId);
        if (btn) {
          btn.addEventListener('click', handleDropdownButtonClick);
        }
      });

      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', handleCheckboxChange);
      });

      document.addEventListener('click', handleOutsideClick);

      // Handle resize
      const resizeObserver = new ResizeObserver(() => {
        myChart.resize();
      });

      resizeObserver.observe(chartDom);

      // Listen for legend selection changes
      myChart.on('legendselectchanged', function(params) {
        const modelName = params.name;
        
        const allRegressionModels = Object.values(modelGroups['regression']).flat();
        const isRegressionModelSelected = allRegressionModels.some(model => params.selected[model]);
        
        if (allRegressionModels.includes(modelName)) {
          const btn = document.getElementById('regression-btn');
          if (btn) {
            btn.setAttribute('data-active', isRegressionModelSelected.toString());
            document.getElementById('regression-btn-container').setAttribute('data-active', isRegressionModelSelected.toString());
          }
          
          for (const [type, models] of Object.entries(modelGroups['regression'])) {
            if (models.includes(modelName)) {
              const checkbox = document.querySelector(`input[name="regression-${type}"]`);
              if (checkbox) {
                const isGroupSelected = models.some(model => params.selected[model]);
                checkbox.checked = isGroupSelected;
              }
            }
          }
        }
        
        const allMultiviewModels = Object.values(modelGroups['multiview']).flat();
        const isMultiviewModelSelected = allMultiviewModels.some(model => params.selected[model]);
        
        if (allMultiviewModels.includes(modelName)) {
          const btn = document.getElementById('multiview-btn');
          if (btn) {
            btn.setAttribute('data-active', isMultiviewModelSelected.toString());
            document.getElementById('multiview-btn-container').setAttribute('data-active', isMultiviewModelSelected.toString());
          }
          
          for (const [type, models] of Object.entries(modelGroups['multiview'])) {
            if (models.includes(modelName)) {
              const checkbox = document.querySelector(`input[name="multiview-${type}"]`);
              if (checkbox) {
                const isGroupSelected = models.some(model => params.selected[model]);
                checkbox.checked = isGroupSelected;
              }
            }
          }
        }
        
        const allNativeModels = Object.values(modelGroups['native']).flat();
        const isNativeModelSelected = allNativeModels.some(model => params.selected[model]);
        
        if (allNativeModels.includes(modelName)) {
          const btn = document.getElementById('native-btn');
          if (btn) {
            btn.setAttribute('data-active', isNativeModelSelected.toString());
            document.getElementById('native-btn-container').setAttribute('data-active', isNativeModelSelected.toString());
          }
          
          for (const [type, models] of Object.entries(modelGroups['native'])) {
            if (models.includes(modelName)) {
              const checkbox = document.querySelector(`input[name="native-${type}"]`);
              if (checkbox) {
                const isGroupSelected = models.some(model => params.selected[model]);
                checkbox.checked = isGroupSelected;
              }
            }
          }
        }
      });

      // Clean up on unload
      window.addEventListener('unload', () => {
        resizeObserver.disconnect();
        myChart.dispose();
      });

      // After initializing the chart, update the UI to match the default selections
      const updateUIFromSelection = () => {
        // Check if any models in a group are selected
        const isRegressionActive = myChart.getOption().legend[0].selected?.['SF3D'] || false;
        const isMultiviewActive = myChart.getOption().legend[0].selected?.['InstantMesh'] || false;
        const isNativeActive = myChart.getOption().legend[0].selected?.['Trellis'] || false;
        
        // Update buttons
        document.getElementById('regression-btn').setAttribute('data-active', isRegressionActive.toString());
        document.getElementById('regression-btn-container').setAttribute('data-active', isRegressionActive.toString());
        
        document.getElementById('multiview-btn').setAttribute('data-active', isMultiviewActive.toString());
        document.getElementById('multiview-btn-container').setAttribute('data-active', isMultiviewActive.toString());
        
        document.getElementById('native-btn').setAttribute('data-active', isNativeActive.toString());
        document.getElementById('native-btn-container').setAttribute('data-active', isNativeActive.toString());
      };
      
      // Initialize the chart with data
      updateChart();
      updateUIFromSelection();
      
      // // Make sure all checkboxes are checked and models are selected
      // document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      //   checkbox.checked = true;
      // });
      // updateModelSelections();

      // // Update the page title and chart title
      // document.title = "Model Performance Across Visual Cues";
      // document.querySelector('.chart-title').textContent = "Model Performance Across Visual Cues";
    });
  </script>
</body>
</html>